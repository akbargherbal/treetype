import"./modulepreload-polyfill-YP0FEG5d.js";import{l as t,a as e,s,P as n}from"./config-wtE3mAnz.js";import{g as a,f as i,c as r,a as o}from"./timer-Bqna9vei.js";import{s as d}from"./storage-DL_W2Xu7.js";class l{constructor(t){const e=document.getElementById(t);if(!e)throw new Error(`Element with id "${t}" not found`);this.container=e}renderCode(t,e){this.container.innerHTML="",t.lines.forEach((t,s)=>{const n=this.createLineElement(t,s,e);this.container.appendChild(n)})}updateCurrentLine(t,e,s){const n=document.getElementById(`line-content-${e}`);n&&t&&(n.innerHTML="",this.renderLineTokens(n,t,e,s)),document.querySelectorAll(".line").forEach((t,s)=>{s===e?t.classList.add("test-active-line"):t.classList.remove("test-active-line")})}createLineElement(t,e,s){const n=document.createElement("div");n.className="line flex",n.id=`line-${e}`,e===s.currentLineIndex&&n.classList.add("test-active-line");const a=document.createElement("span");a.className="line-number",a.textContent=String(t.line_number+1),n.appendChild(a);const i=document.createElement("div");return i.className="flex-1",i.style.paddingLeft=16*t.indent_level+"px",i.id=`line-content-${e}`,this.renderLineTokens(i,t,e,s),n.appendChild(i),n}renderLineTokens(t,e,s,n){let a=0,i=0;const r=s===n.currentLineIndex,o=n.completedLines.has(s),d=s>n.currentLineIndex;e.display_tokens.forEach(s=>{if(s.start_col>a){const e=" ".repeat(s.start_col-a);t.appendChild(document.createTextNode(e))}const l=this.getCssClass(s.type,s.text);if(s.typeable)for(let e=0;e<s.text.length;e++){const a=document.createElement("span");a.textContent=s.text[e],a.className=l,o||(d?a.classList.add("char-untyped"):r&&(i<n.currentCharIndex||(i===n.currentCharIndex?(n.errorOnCurrentChar?a.classList.add("char-error"):a.classList.add("char-current"),a.classList.add("char-untyped"),a.id="current-char"):a.classList.add("char-untyped")))),t.appendChild(a),i++}else{const a=document.createElement("span");if(a.textContent=s.text,a.className=l,o);else if(d)a.classList.add("char-untyped");else if(r){const t=e.char_map[String(n.currentCharIndex)],i=t?.display_col||0;s.start_col>i&&a.classList.add("char-untyped")}t.appendChild(a)}a=s.end_col})}getCssClass(t,e){if(["(",")","[","]","{","}","<",">"].includes(t))return"bracket";return["def","function","class","return","if","elif","else","for","while","import","from","as","const","let","var","async","await","interface","type","export","default"].includes(t)?t:t.includes("comment")?"comment":t.includes("string")?t.replace(/_/g,"_"):"integer"===t||"number"===t||"float"===t?"number":t.includes("identifier")?t:["->","=>","=","+","-","*","/","%","++","--"].includes(t)?"operator":[":",";",",","."].includes(t)?"punctuation":t.replace(/[^a-zA-Z0-9_]/g,"_")}}class c{constructor(t,e,s,n){this.state=t,this.data=e,this.snippetInfo=s,this.callbacks=n}updateReferences(t,e){this.state=t,this.data=e}handleKeyPress(t){if("Tab"===t.key&&this.state.active)return t.preventDefault(),void this.callbacks.onPauseToggle();if(this.state.paused)return void("Escape"===t.key&&(t.preventDefault(),this.callbacks.onReset()));if(t.ctrlKey||t.metaKey||t.altKey)return;if("Escape"===t.key)return t.preventDefault(),void this.callbacks.onReset();if(t.key.length>1&&"Enter"!==t.key&&" "!==t.key)return;if(t.preventDefault(),!this.data)return;this.state.active||this.callbacks.onTestStart();const e=this.data.lines[this.state.currentLineIndex];if(!e)return;const s=e.typing_sequence[this.state.currentCharIndex];t.key===s?(this.state.currentCharIndex++,this.state.totalCharsTyped++,this.state.errorOnCurrentChar=!1,this.callbacks.onCharacterTyped(!0),this.state.currentCharIndex>=e.typing_sequence.length&&setTimeout(()=>{this.callbacks.onLineComplete()},50)):(this.state.totalErrors++,this.state.errorOnCurrentChar=!0,this.callbacks.onCharacterTyped(!1))}moveToNextLine(){for(this.state.completedLines.add(this.state.currentLineIndex),this.state.currentLineIndex++,this.state.currentCharIndex=0,this.state.errorOnCurrentChar=!1;this.state.currentLineIndex<this.data.total_lines;){const t=this.data.lines[this.state.currentLineIndex];if(t&&t.typing_sequence&&t.typing_sequence.length>0)break;this.state.completedLines.add(this.state.currentLineIndex),this.state.currentLineIndex++}return!(this.state.currentLineIndex>=this.data.total_lines)||(this.callbacks.onTestComplete(),!1)}}class u{constructor(){this.data=null,this.rawData=null,this.keyboardHandler=null,this.state=this.initializeState(),this.snippetInfo={path:null,id:null,language:null},this.renderer=new l("codeLines"),this.setupEventListeners(),this.loadInitialSnippet()}initializeState(){return{active:!1,paused:!1,startTime:null,endTime:null,pauseStartTime:null,totalPausedTime:0,currentLineIndex:0,currentCharIndex:0,totalCharsTyped:0,totalErrors:0,completedLines:new Set,errorOnCurrentChar:!1}}setupEventListeners(){document.addEventListener("keydown",t=>{this.keyboardHandler?.handleKeyPress(t)});document.getElementById("languageSelect").addEventListener("change",t=>{this.loadLanguage(t.target.value),this.saveCurrentConfig()}),document.querySelectorAll('input[name="typingMode"]').forEach(t=>{t.addEventListener("change",()=>{this.reapplyTypingMode(),this.saveCurrentConfig()})}),document.getElementById("resetBtn")?.addEventListener("click",()=>{this.resetTest()}),document.getElementById("pauseBtn")?.addEventListener("click",()=>{this.togglePause()});const t=document.getElementById("codeDisplay");t?.addEventListener("click",()=>{t.classList.add("focused")}),t?.addEventListener("blur",()=>{t.classList.remove("focused")})}async loadInitialSnippet(){const e=t(),s=document.querySelector(`input[name="typingMode"][value="${e.preset}"]`);s&&(s.checked=!0);document.getElementById("languageSelect").value=e.language,await this.loadLanguage(e.language),setTimeout(()=>{document.getElementById("codeDisplay")?.focus()},100)}async loadLanguage(t){const e=new URLSearchParams(window.location.search).get("snippet");let s;if(e)s=e;else{s={python:"snippets/python/gm_01_001_02_03_core-python-patterns-quick-refresh.json",javascript:"snippets/javascript/gm_01_001_01_array-methods.json",typescript:"snippets/typescript/gm_01_026_01_apidata-patterns.json",tsx:"snippets/tsx/gm_01_014_01_async-patterns.json"}[t]}try{const t=await fetch(s);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);this.rawData=await t.json(),this.snippetInfo.path=s,this.snippetInfo.language=this.rawData.language;const e=s.split("/"),n=e[e.length-1].replace(".json",""),a=e[e.length-2];this.snippetInfo.id=`${a}-${n}`,console.log("Loaded snippet:",this.snippetInfo),this.reapplyTypingMode(),this.resetTest()}catch(n){console.error("Error loading file:",n);const t=document.getElementById("codeLines");t&&(t.innerHTML=`\n          <div class="text-red-400">\n            Error loading snippet<br>\n            Make sure you're running this from the project root directory.<br>\n            Error: ${n instanceof Error?n.message:String(n)}<br><br>\n            <a href="library.html" class="text-blue-400 underline">Go to Library to select a snippet</a>\n          </div>\n        `)}}reapplyTypingMode(){if(!this.rawData)return;const t=document.querySelector('input[name="typingMode"]:checked')?.value;this.data={...this.rawData,lines:this.rawData.lines.map(s=>e(s,t))},this.keyboardHandler&&this.data&&this.keyboardHandler.updateReferences(this.state,this.data)}saveCurrentConfig(){const t=document.querySelector('input[name="typingMode"]:checked')?.value,e=document.getElementById("languageSelect")?.value;s({preset:t,language:e})}resetTest(){if(this.state=this.initializeState(),this.data)for(;this.state.currentLineIndex<this.data.total_lines&&(!this.data.lines[this.state.currentLineIndex]||0===this.data.lines[this.state.currentLineIndex].typing_sequence.length);)this.state.currentLineIndex++;document.body.classList.remove("test-active"),this.hidePauseOverlay(),this.data&&(this.renderer.renderCode(this.data,this.state),this.keyboardHandler=new c(this.state,this.data,this.snippetInfo,{onTestStart:()=>this.startTest(),onCharacterTyped:()=>this.updateDisplay(),onLineComplete:()=>this.moveToNextLine(),onTestComplete:()=>this.completeTest(),onPauseToggle:()=>this.togglePause(),onReset:()=>{this.closeModal(),this.resetTest()}})),this.updateStats(),this.updatePauseButton(),this.updateStatus("Press any key to start..."),requestAnimationFrame(()=>{const t=document.getElementById(`line-${this.state.currentLineIndex}`);if(t){const e=t.offsetTop-window.innerHeight/4+t.offsetHeight/4;window.scrollTo({top:e,behavior:"auto"})}})}startTest(){this.state.active=!0,this.state.startTime=Date.now(),this.updateStatus("Typing...","success"),document.body.classList.add("test-active"),this.updatePauseButton()}togglePause(){if(this.state.active){if(this.state.paused){console.log("Resuming test");const t=Date.now()-(this.state.pauseStartTime||0);this.state.totalPausedTime+=t,this.state.paused=!1,this.state.pauseStartTime=null,this.hidePauseOverlay(),this.updatePauseButton(),this.updateStatus("Typing...","success"),document.getElementById("codeDisplay")?.focus()}else console.log("Pausing test"),this.state.paused=!0,this.state.pauseStartTime=Date.now(),this.showPauseOverlay(),this.updatePauseButton(),this.updateStatus("Paused (Tab to resume)","warning");this.updateStats()}else console.log("Cannot pause: test not active")}showPauseOverlay(){this.hidePauseOverlay();const t=document.createElement("div");t.id="pauseOverlay",t.className="pause-overlay",t.innerHTML='\n      <div class="pause-content">\n        <div class="pause-icon">‚∏∏</div>\n        <h2 class="text-3xl font-bold mb-4">Paused</h2>\n        <p class="text-lg mb-2">Press <kbd class="pause-kbd">Tab</kbd> to resume</p>\n        <p class="text-sm text-gray-400 mt-4">or <kbd class="pause-kbd">Esc</kbd> to reset test</p>\n      </div>\n    ',document.body.appendChild(t),t.addEventListener("click",()=>this.togglePause())}hidePauseOverlay(){const t=document.getElementById("pauseOverlay");t&&t.remove()}updatePauseButton(){const t=document.getElementById("pauseBtn");t&&(this.state.paused?(t.textContent="‚ñ∂Ô∏è Resume",t.classList.add("paused-state")):(t.textContent="‚∏∏ Pause",t.classList.remove("paused-state")),this.state.active?(t.removeAttribute("disabled"),t.classList.remove("opacity-50","cursor-not-allowed")):(t.setAttribute("disabled","true"),t.classList.add("opacity-50","cursor-not-allowed")))}updateDisplay(){if(!this.data)return;const t=this.data.lines[this.state.currentLineIndex];this.renderer.updateCurrentLine(t,this.state.currentLineIndex,this.state),this.updateStats()}moveToNextLine(){if(!this.keyboardHandler)return;this.keyboardHandler.moveToNextLine()&&this.data&&(this.renderer.renderCode(this.data,this.state),this.updateStats(),setTimeout(()=>this.smartScroll(),0))}smartScroll(){const t=document.getElementById(`line-${this.state.currentLineIndex}`);if(!t)return;const e=window.scrollY,s=window.innerHeight,n=t.offsetTop-s/4+t.offsetHeight/4;n>e&&window.scrollTo({top:n})}completeTest(){this.state.active=!1,this.state.endTime=Date.now(),document.body.classList.remove("test-active");const t=a(this.state),e=i(t),s=r(this.state.totalCharsTyped,t),n=o(this.state.totalCharsTyped,this.state.totalErrors);this.snippetInfo.id&&d(this.snippetInfo.id,s,n),this.updatePauseButton(),this.showCompletionModal(s,n,e),this.updateStats()}showCompletionModal(t,e,s){const n=document.createElement("div");n.className="modal-overlay",n.id="completionModal",n.innerHTML=`\n      <div class="modal-content p-8 gap-5" style="max-width: 525px">\n        \x3c!-- Header --\x3e\n        <div>\n          <h2 class="text-4xl font-bold">üéâ Test Complete!</h2>\n          <p class="text-lg text-gray-400 mt-2">Great job on completing the test</p>\n        </div>\n\n        \x3c!-- Stats (Integrated Grid) --\x3e\n        <div class="grid grid-cols-3 gap-4 py-3 text-center">\n          <div>\n            <p class="text-base text-gray-400 uppercase tracking-wider">WPM</p>\n            <p class="text-5xl font-bold text-green-400">${t}</p>\n          </div>\n          <div>\n            <p class="text-base text-gray-400 uppercase tracking-wider">Accuracy</p>\n            <p class="text-5xl font-bold text-green-400">${e}%</p>\n          </div>\n          <div>\n            <p class="text-base text-gray-400 uppercase tracking-wider">Time</p>\n            <p class="text-5xl font-bold text-green-400">${s}</p>\n          </div>\n        </div>\n\n        \x3c!-- Divider --\x3e\n        <hr class="border-gray-600" />\n\n        \x3c!-- Buttons (2x2 Grid for equal sizing) --\x3e\n        <div class="grid grid-cols-2 gap-4">\n          <button id="retryBtn" class="modal-button modal-button-primary text-lg py-4 px-5">\n            <span>üîÑ</span> Retry\n          </button>\n          <button id="randomBtn" class="modal-button modal-button-primary text-lg py-4 px-5">\n            <span>üé≤</span> Random\n          </button>\n          <button id="libraryBtn" class="modal-button modal-button-secondary text-lg py-4 px-5">\n            <span>üìö</span> Library\n          </button>\n          <button id="settingsBtn" class="modal-button modal-button-secondary text-lg py-4 px-5">\n            <span>‚öôÔ∏è</span> Settings\n          </button>\n        </div>\n      </div>\n    `,document.body.appendChild(n),document.getElementById("retryBtn")?.addEventListener("click",()=>{this.closeModal(),this.resetTest()}),document.getElementById("randomBtn")?.addEventListener("click",()=>{this.loadRandomSnippet()}),document.getElementById("libraryBtn")?.addEventListener("click",()=>{window.location.href="library.html"}),document.getElementById("settingsBtn")?.addEventListener("click",()=>{this.closeModal()}),n.addEventListener("click",t=>{t.target===n&&this.closeModal()})}closeModal(){const t=document.getElementById("completionModal");t&&t.remove()}async loadRandomSnippet(){try{const t=await fetch("snippets/metadata.json");if(!t.ok)throw new Error("Cannot fetch metadata");const e=(await t.json()).snippets,s=e[Math.floor(Math.random()*e.length)];window.location.href=`index.html?snippet=${encodeURIComponent(s.path)}`}catch(t){console.error("Error loading random snippet:",t),alert("Could not load random snippet. Please try again.")}}updateStats(){if(!this.data)return;const t=this.data.lines[this.state.currentLineIndex],e=t?`${this.state.currentCharIndex}/${t.typing_sequence.length}`:"0/0";let s=0,i=100;if(this.state.active&&this.state.startTime&&!this.state.paused){const t=a(this.state);s=r(this.state.totalCharsTyped,t)}this.state.totalCharsTyped>0&&(i=o(this.state.totalCharsTyped,this.state.totalErrors));const d=document.querySelector('input[name="typingMode"]:checked')?.value,l=n[d]?.name||d,c=document.getElementById("stats");c&&(c.innerHTML=`\n        <div class="grid grid-cols-6 gap-4 text-sm">\n          <div><div class="text-gray-400">Language</div><div class="font-bold">${this.data.language}</div></div>\n          <div><div class="text-gray-400">Mode</div><div class="font-bold">${l}</div></div>\n          <div><div class="text-gray-400">Line Progress</div><div class="font-bold">${this.state.currentLineIndex+1}/${this.data.total_lines}</div></div>\n          <div><div class="text-gray-400">Char Progress</div><div class="font-bold">${e}</div></div>\n          <div><div class="text-gray-400">WPM</div><div class="font-bold">${s}</div></div>\n          <div><div class="text-gray-400">Accuracy</div><div class="font-bold ${i<95?"text-yellow-400":"text-green-400"}">${i}%</div></div>\n        </div>\n      `)}updateStatus(t,e="info"){const s=document.getElementById("testStatus"),n={info:"text-gray-400",success:"text-green-400",error:"text-red-400",warning:"text-yellow-400"};s&&(s.innerHTML=`<span class="${n[e]}">${t}</span>`)}}document.addEventListener("DOMContentLoaded",()=>{new u});
//# sourceMappingURL=main-nd08ngRc.js.map
