{"version":3,"file":"library-TNPGfQ_D.js","sources":["../../src/library.ts"],"sourcesContent":["import { SnippetMetadata } from \"./types/snippet.js\";\r\nimport { SnippetStats } from \"./types/state.js\";\r\nimport { loadSnippetStats } from \"./core/storage.js\";\r\n\r\n/**\r\n * Library page for browsing and selecting code snippets\r\n */\r\nexport class LibraryPage {\r\n  private allSnippets: SnippetMetadata[] = [];\r\n  private userStats: Record<string, SnippetStats> = {};\r\n  private currentFilter: string = \"all\";\r\n  private currentSearch: string = \"\";\r\n  private currentSort: string = \"name\";\r\n\r\n  constructor() {\r\n    this.initialize();\r\n  }\r\n\r\n  /**\r\n   * Initialize the library page\r\n   */\r\n  private async initialize(): Promise<void> {\r\n    this.setupEventListeners();\r\n    await this.loadMetadata();\r\n  }\r\n\r\n  /**\r\n   * Load snippet metadata from JSON file\r\n   */\r\n  private async loadMetadata(): Promise<void> {\r\n    try {\r\n      const response = await fetch(\"snippets/metadata.json\");\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n      const data = await response.json();\r\n      this.allSnippets = data.snippets;\r\n\r\n      // Load user statistics\r\n      this.userStats = loadSnippetStats();\r\n\r\n      // Render everything\r\n      this.renderSummaryStats();\r\n      this.renderSnippets();\r\n\r\n      // Hide loading, show grid\r\n      document.getElementById(\"loadingState\")?.classList.add(\"hidden\");\r\n      document.getElementById(\"snippetGrid\")?.classList.remove(\"hidden\");\r\n    } catch (error) {\r\n      console.error(\"Error loading metadata:\", error);\r\n      const loadingEl = document.getElementById(\"loadingState\");\r\n      if (loadingEl) {\r\n        loadingEl.innerHTML = `\r\n          <div class=\"text-center text-red-400\">\r\n            <div class=\"text-4xl mb-4\">‚ö†Ô∏è</div>\r\n            <h3 class=\"text-xl font-bold mb-2\">Failed to load snippets</h3>\r\n            <p>Error: ${error instanceof Error ? error.message : String(error)}</p>\r\n            <p class=\"mt-2 text-sm\">Make sure you're running from the project root directory</p>\r\n          </div>\r\n        `;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate and render summary statistics\r\n   */\r\n  private renderSummaryStats(): void {\r\n    const statsEntries = Object.values(this.userStats);\r\n\r\n    // Total snippets\r\n    const totalEl = document.getElementById(\"totalSnippets\");\r\n    if (totalEl) totalEl.textContent = String(this.allSnippets.length);\r\n\r\n    // Practiced count\r\n    const practicedEl = document.getElementById(\"practicedCount\");\r\n    if (practicedEl) practicedEl.textContent = String(statsEntries.length);\r\n\r\n    // Average and best WPM\r\n    if (statsEntries.length > 0) {\r\n      const avgWPM =\r\n        statsEntries.reduce((sum, s) => sum + (s.bestWPM || 0), 0) /\r\n        statsEntries.length;\r\n      const maxWPM = Math.max(...statsEntries.map((s) => s.bestWPM || 0));\r\n\r\n      const avgEl = document.getElementById(\"averageWPM\");\r\n      if (avgEl) avgEl.textContent = String(Math.round(avgWPM));\r\n\r\n      const bestEl = document.getElementById(\"bestWPM\");\r\n      if (bestEl) bestEl.textContent = String(maxWPM);\r\n    } else {\r\n      const avgEl = document.getElementById(\"averageWPM\");\r\n      if (avgEl) avgEl.textContent = \"0\";\r\n\r\n      const bestEl = document.getElementById(\"bestWPM\");\r\n      if (bestEl) bestEl.textContent = \"0\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Filter and sort snippets based on current settings\r\n   */\r\n  private filterAndSortSnippets(): SnippetMetadata[] {\r\n    let filtered = [...this.allSnippets];\r\n\r\n    // Language filter\r\n    if (this.currentFilter !== \"all\") {\r\n      filtered = filtered.filter((s) => s.language === this.currentFilter);\r\n    }\r\n\r\n    // Search filter\r\n    if (this.currentSearch) {\r\n      const searchLower = this.currentSearch.toLowerCase();\r\n      filtered = filtered.filter((s) =>\r\n        s.name.toLowerCase().includes(searchLower)\r\n      );\r\n    }\r\n\r\n    // Sort\r\n    filtered.sort((a, b) => {\r\n      switch (this.currentSort) {\r\n        case \"name\":\r\n          return a.name.localeCompare(b.name);\r\n        case \"wpm\": {\r\n          const aStats = this.userStats[a.id] || {};\r\n          const bStats = this.userStats[b.id] || {};\r\n          return (bStats.bestWPM || 0) - (aStats.bestWPM || 0);\r\n        }\r\n        case \"practiced\": {\r\n          const aStats = this.userStats[a.id] || {};\r\n          const bStats = this.userStats[b.id] || {};\r\n          return (bStats.practiceCount || 0) - (aStats.practiceCount || 0);\r\n        }\r\n        case \"lines\":\r\n          return a.lines - b.lines;\r\n        default:\r\n          return 0;\r\n      }\r\n    });\r\n\r\n    return filtered;\r\n  }\r\n\r\n  /**\r\n   * Render snippet cards in the grid\r\n   */\r\n  private renderSnippets(): void {\r\n    const filtered = this.filterAndSortSnippets();\r\n    const grid = document.getElementById(\"snippetGrid\");\r\n    const emptyState = document.getElementById(\"emptyState\");\r\n\r\n    if (!grid || !emptyState) return;\r\n\r\n    if (filtered.length === 0) {\r\n      grid.classList.add(\"hidden\");\r\n      emptyState.classList.remove(\"hidden\");\r\n      return;\r\n    }\r\n\r\n    grid.classList.remove(\"hidden\");\r\n    emptyState.classList.add(\"hidden\");\r\n\r\n    grid.innerHTML = filtered\r\n      .map((snippet) => this.createSnippetCard(snippet))\r\n      .join(\"\");\r\n  }\r\n\r\n  /**\r\n   * Create HTML for a single snippet card\r\n   */\r\n  private createSnippetCard(snippet: SnippetMetadata): string {\r\n    const stats = this.userStats[snippet.id] || {};\r\n    const practiced = (stats.practiceCount || 0) > 0;\r\n\r\n    const statsHtml = practiced\r\n      ? `\r\n          <div class=\"stats-display\">\r\n            <div class=\"flex justify-between text-xs mb-1\">\r\n              <span class=\"text-gray-400\">Best WPM:</span>\r\n              <span class=\"font-bold text-green-400\">${stats.bestWPM || 0}</span>\r\n            </div>\r\n            <div class=\"flex justify-between text-xs\">\r\n              <span class=\"text-gray-400\">Practiced:</span>\r\n              <span class=\"font-bold\">${stats.practiceCount}x</span>\r\n            </div>\r\n          </div>\r\n        `\r\n      : `\r\n          <div class=\"stats-display\">\r\n            <div class=\"text-xs text-gray-500 text-center\">Not practiced yet</div>\r\n          </div>\r\n        `;\r\n\r\n    const cleanedName = this.cleanName(snippet.name);\r\n    const escapedPath = this.escapeHtml(snippet.path);\r\n\r\n    return `\r\n          <div class=\"snippet-card\" onclick=\"window.libraryPage.practiceSnippet('${escapedPath}')\">\r\n            <div class=\"flex items-start justify-between gap-2\">\r\n              <h3 class=\"font-bold text-lg flex-1 leading-tight\">${cleanedName}</h3>\r\n              <span class=\"language-badge lang-${snippet.language}\">${snippet.language}</span>\r\n            </div>\r\n            \r\n            <div class=\"flex gap-2 items-center text-sm text-gray-400\">\r\n              <span>üìÑ ${snippet.lines} lines</span>\r\n              <span>‚Ä¢</span>\r\n              <span>‚å®Ô∏è ${snippet.typeable_chars} chars</span>\r\n            </div>\r\n\r\n            ${statsHtml}\r\n\r\n            <button class=\"practice-button mt-auto\" onclick=\"window.libraryPage.practiceSnippet('${escapedPath}'); event.stopPropagation();\">\r\n              ${practiced ? \"Practice Again\" : \"Start Practice\"}\r\n            </button>\r\n          </div>\r\n        `;\r\n  }\r\n\r\n  /**\r\n   * Clean snippet name for display\r\n   */\r\n  private cleanName(name: string): string {\r\n    // Remove \"Gm 01 ###_## \" prefix and replace hyphens with spaces\r\n    return name.replace(/^Gm \\d+ \\d+_\\d+ /, \"\").replace(/-/g, \" \");\r\n  }\r\n\r\n  /**\r\n   * Escape HTML special characters\r\n   */\r\n  private escapeHtml(text: string): string {\r\n    const div = document.createElement(\"div\");\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  /**\r\n   * Navigate to practice page with selected snippet\r\n   */\r\n  public practiceSnippet(path: string): void {\r\n    window.location.href = `index.html?snippet=${encodeURIComponent(path)}`;\r\n  }\r\n\r\n  /**\r\n   * Setup event listeners for filters, search, and sort\r\n   */\r\n  private setupEventListeners(): void {\r\n    // Language filter buttons\r\n    document\r\n      .querySelectorAll<HTMLButtonElement>(\".filter-button[data-language]\")\r\n      .forEach((btn) => {\r\n        btn.addEventListener(\"click\", () => {\r\n          // Remove active class from all\r\n          document\r\n            .querySelectorAll(\".filter-button[data-language]\")\r\n            .forEach((b) => b.classList.remove(\"active\"));\r\n\r\n          // Add active to clicked button\r\n          btn.classList.add(\"active\");\r\n\r\n          // Update filter and re-render\r\n          this.currentFilter = btn.dataset.language || \"all\";\r\n          this.renderSnippets();\r\n        });\r\n      });\r\n\r\n    // Search input\r\n    const searchInput = document.getElementById(\r\n      \"searchInput\"\r\n    ) as HTMLInputElement;\r\n    if (searchInput) {\r\n      searchInput.addEventListener(\"input\", (e) => {\r\n        this.currentSearch = (e.target as HTMLInputElement).value;\r\n        this.renderSnippets();\r\n      });\r\n    }\r\n\r\n    // Sort dropdown\r\n    const sortSelect = document.getElementById(\r\n      \"sortSelect\"\r\n    ) as HTMLSelectElement;\r\n    if (sortSelect) {\r\n      sortSelect.addEventListener(\"change\", (e) => {\r\n        this.currentSort = (e.target as HTMLSelectElement).value;\r\n        this.renderSnippets();\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\n// Declare global type for window.libraryPage\r\ndeclare global {\r\n  interface Window {\r\n    libraryPage: LibraryPage;\r\n  }\r\n}\r\n\r\n// Initialize when DOM is ready\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  window.libraryPage = new LibraryPage();\r\n});"],"names":["LibraryPage","constructor","this","allSnippets","userStats","currentFilter","currentSearch","currentSort","initialize","setupEventListeners","loadMetadata","response","fetch","ok","Error","status","data","json","snippets","loadSnippetStats","renderSummaryStats","renderSnippets","document","getElementById","classList","add","remove","error","console","loadingEl","innerHTML","message","String","statsEntries","Object","values","totalEl","textContent","length","practicedEl","avgWPM","reduce","sum","s","bestWPM","maxWPM","Math","max","map","avgEl","round","bestEl","filterAndSortSnippets","filtered","filter","language","searchLower","toLowerCase","name","includes","sort","a","b","localeCompare","aStats","id","practiceCount","lines","grid","emptyState","snippet","createSnippetCard","join","stats","practiced","statsHtml","cleanedName","cleanName","escapedPath","escapeHtml","path","typeable_chars","replace","text","div","createElement","practiceSnippet","window","location","href","encodeURIComponent","querySelectorAll","forEach","btn","addEventListener","dataset","searchInput","e","target","value","sortSelect","libraryPage"],"mappings":"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"}