{"version":3,"file":"main-nd08ngRc.js","sources":["../../src/ui/renderer.ts","../../src/ui/keyboard.ts","../../src/app.ts","../../index.html?html-proxy&index=1.js"],"sourcesContent":["import { SnippetData, Line, Token } from \"../types/snippet\";\nimport { TestState } from \"../types/state\";\n\n/**\n * Handles rendering of code display\n */\nexport class CodeRenderer {\n  private container: HTMLElement;\n\n  constructor(containerId: string) {\n    const element = document.getElementById(containerId);\n    if (!element) {\n      throw new Error(`Element with id \"${containerId}\" not found`);\n    }\n    this.container = element;\n  }\n\n  /**\n   * Render entire code snippet\n   */\n  renderCode(data: SnippetData, state: TestState): void {\n    this.container.innerHTML = \"\";\n\n    data.lines.forEach((lineData, lineIndex) => {\n      const lineDiv = this.createLineElement(lineData, lineIndex, state);\n      this.container.appendChild(lineDiv);\n    });\n  }\n\n  /**\n   * Update only the current line (for performance)\n   */\n  updateCurrentLine(\n    lineData: Line,\n    lineIndex: number,\n    state: TestState\n  ): void {\n    const contentDiv = document.getElementById(`line-content-${lineIndex}`);\n    if (contentDiv && lineData) {\n      contentDiv.innerHTML = \"\";\n      this.renderLineTokens(contentDiv, lineData, lineIndex, state);\n    }\n\n    // Update active line indicator\n    document.querySelectorAll(\".line\").forEach((line, idx) => {\n      if (idx === lineIndex) {\n        line.classList.add(\"test-active-line\");\n      } else {\n        line.classList.remove(\"test-active-line\");\n      }\n    });\n  }\n\n  /**\n   * Create a line element with line number and content\n   */\n  private createLineElement(\n    lineData: Line,\n    lineIndex: number,\n    state: TestState\n  ): HTMLElement {\n    const lineDiv = document.createElement(\"div\");\n    lineDiv.className = \"line flex\";\n    lineDiv.id = `line-${lineIndex}`;\n\n    if (lineIndex === state.currentLineIndex) {\n      lineDiv.classList.add(\"test-active-line\");\n    }\n\n    // Line number\n    const lineNum = document.createElement(\"span\");\n    lineNum.className = \"line-number\";\n    lineNum.textContent = String(lineData.line_number + 1);\n    lineDiv.appendChild(lineNum);\n\n    // Content\n    const contentDiv = document.createElement(\"div\");\n    contentDiv.className = \"flex-1\";\n    contentDiv.style.paddingLeft = `${lineData.indent_level * 16}px`;\n    contentDiv.id = `line-content-${lineIndex}`;\n\n    this.renderLineTokens(contentDiv, lineData, lineIndex, state);\n\n    lineDiv.appendChild(contentDiv);\n    return lineDiv;\n  }\n\n  /**\n   * Render tokens for a single line with progressive reveal\n   */\n  private renderLineTokens(\n    container: HTMLElement,\n    lineData: Line,\n    lineIndex: number,\n    state: TestState\n  ): void {\n    let currentCol = 0;\n    let typedCharCount = 0;\n\n    const isCurrentLine = lineIndex === state.currentLineIndex;\n    const isCompletedLine = state.completedLines.has(lineIndex);\n    const isFutureLine = lineIndex > state.currentLineIndex;\n\n    lineData.display_tokens.forEach((token) => {\n      // Add spacing before token if needed\n      if (token.start_col > currentCol) {\n        const spaces = \" \".repeat(token.start_col - currentCol);\n        container.appendChild(document.createTextNode(spaces));\n      }\n\n      const baseCssClass = this.getCssClass(token.type, token.text);\n\n      if (token.typeable) {\n        // Render each character of typeable token individually\n        for (let i = 0; i < token.text.length; i++) {\n          const charSpan = document.createElement(\"span\");\n          charSpan.textContent = token.text[i];\n          charSpan.className = baseCssClass;\n\n          if (isCompletedLine) {\n            // Already typed - show with syntax highlighting\n          } else if (isFutureLine) {\n            // Not yet reached - show as gray\n            charSpan.classList.add(\"char-untyped\");\n          } else if (isCurrentLine) {\n            if (typedCharCount < state.currentCharIndex) {\n              // Already typed on current line - show with syntax highlighting\n            } else if (typedCharCount === state.currentCharIndex) {\n              // Current character to type\n              if (state.errorOnCurrentChar) {\n                charSpan.classList.add(\"char-error\");\n              } else {\n                charSpan.classList.add(\"char-current\");\n              }\n              charSpan.classList.add(\"char-untyped\");\n              charSpan.id = \"current-char\";\n            } else {\n              // Future character on current line\n              charSpan.classList.add(\"char-untyped\");\n            }\n          }\n\n          container.appendChild(charSpan);\n          typedCharCount++;\n        }\n      } else {\n        // Non-typeable token - render as single span\n        const tokenSpan = document.createElement(\"span\");\n        tokenSpan.textContent = token.text;\n        tokenSpan.className = baseCssClass;\n\n        if (isCompletedLine) {\n          // Already typed - show with syntax highlighting\n        } else if (isFutureLine) {\n          // Not yet reached - show as gray\n          tokenSpan.classList.add(\"char-untyped\");\n        } else if (isCurrentLine) {\n          const currentCharInfo =\n            lineData.char_map[String(state.currentCharIndex)];\n          const currentDisplayCol = currentCharInfo?.display_col || 0;\n\n          const tokenStartsAfterCursor = token.start_col > currentDisplayCol;\n\n          if (tokenStartsAfterCursor) {\n            tokenSpan.classList.add(\"char-untyped\");\n          }\n        }\n\n        container.appendChild(tokenSpan);\n      }\n\n      currentCol = token.end_col;\n    });\n  }\n\n  /**\n   * Get CSS class for token type\n   */\n  private getCssClass(type: string, text: string): string {\n    if ([\"(\", \")\", \"[\", \"]\", \"{\", \"}\", \"<\", \">\"].includes(type)) {\n      return \"bracket\";\n    }\n\n    const keywords = [\n      \"def\",\n      \"function\",\n      \"class\",\n      \"return\",\n      \"if\",\n      \"elif\",\n      \"else\",\n      \"for\",\n      \"while\",\n      \"import\",\n      \"from\",\n      \"as\",\n      \"const\",\n      \"let\",\n      \"var\",\n      \"async\",\n      \"await\",\n      \"interface\",\n      \"type\",\n      \"export\",\n      \"default\",\n    ];\n\n    if (keywords.includes(type)) return type;\n    if (type.includes(\"comment\")) return \"comment\";\n    if (type.includes(\"string\")) return type.replace(/_/g, \"_\");\n    if (type === \"integer\" || type === \"number\" || type === \"float\") {\n      return \"number\";\n    }\n    if (type.includes(\"identifier\")) return type;\n    if ([\"->\", \"=>\", \"=\", \"+\", \"-\", \"*\", \"/\", \"%\", \"++\", \"--\"].includes(type)) {\n      return \"operator\";\n    }\n    if ([\":\", \";\", \",\", \".\"].includes(type)) return \"punctuation\";\n\n    return type.replace(/[^a-zA-Z0-9_]/g, \"_\");\n  }\n}","import { TestState, SnippetInfo } from \"../types/state\";\nimport { SnippetData } from \"../types/snippet\";\n\n/**\n * Callback types for keyboard events\n */\nexport interface KeyboardCallbacks {\n  onTestStart: () => void;\n  onCharacterTyped: (correct: boolean) => void;\n  onLineComplete: () => void;\n  onTestComplete: () => void;\n  onPauseToggle: () => void;\n  onReset: () => void;\n}\n\n/**\n * Handles keyboard input during typing test\n */\nexport class KeyboardHandler {\n  private state: TestState;\n  private data: SnippetData;\n  private snippetInfo: SnippetInfo;\n  private callbacks: KeyboardCallbacks;\n\n  constructor(\n    state: TestState,\n    data: SnippetData,\n    snippetInfo: SnippetInfo,\n    callbacks: KeyboardCallbacks\n  ) {\n    this.state = state;\n    this.data = data;\n    this.snippetInfo = snippetInfo;\n    this.callbacks = callbacks;\n  }\n\n  /**\n   * Update state and data references\n   */\n  updateReferences(state: TestState, data: SnippetData): void {\n    this.state = state;\n    this.data = data;\n  }\n\n  /**\n   * Handle keyboard events\n   */\n  handleKeyPress(event: KeyboardEvent): void {\n    // Tab key for pause/resume\n    if (event.key === \"Tab\" && this.state.active) {\n      event.preventDefault();\n      this.callbacks.onPauseToggle();\n      return;\n    }\n\n    // Block input during pause (except Esc)\n    if (this.state.paused) {\n      if (event.key === \"Escape\") {\n        event.preventDefault();\n        this.callbacks.onReset();\n      }\n      return;\n    }\n\n    // Ignore modifier key combinations\n    if (event.ctrlKey || event.metaKey || event.altKey) return;\n\n    // Escape key to reset\n    if (event.key === \"Escape\") {\n      event.preventDefault();\n      this.callbacks.onReset();\n      return;\n    }\n\n    // Ignore special keys (except Enter and Space)\n    if (event.key.length > 1 && event.key !== \"Enter\" && event.key !== \" \") {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (!this.data) return;\n\n    // Start test on first keypress\n    if (!this.state.active) {\n      this.callbacks.onTestStart();\n    }\n\n    const currentLine = this.data.lines[this.state.currentLineIndex];\n    if (!currentLine) return;\n\n    const expectedChar =\n      currentLine.typing_sequence[this.state.currentCharIndex];\n    const typedKey = event.key;\n\n    if (typedKey === expectedChar) {\n      // Correct character\n      this.state.currentCharIndex++;\n      this.state.totalCharsTyped++;\n      this.state.errorOnCurrentChar = false;\n\n      this.callbacks.onCharacterTyped(true);\n\n      // Check if line is complete\n      if (\n        this.state.currentCharIndex >= currentLine.typing_sequence.length\n      ) {\n        setTimeout(() => {\n          this.callbacks.onLineComplete();\n        }, 50);\n      }\n    } else {\n      // Incorrect character\n      this.state.totalErrors++;\n      this.state.errorOnCurrentChar = true;\n\n      this.callbacks.onCharacterTyped(false);\n    }\n  }\n\n  /**\n   * Move to next typeable line\n   * @returns true if moved to next line, false if test complete\n   */\n  moveToNextLine(): boolean {\n    this.state.completedLines.add(this.state.currentLineIndex);\n    this.state.currentLineIndex++;\n    this.state.currentCharIndex = 0;\n    this.state.errorOnCurrentChar = false;\n\n    // Skip empty lines\n    while (this.state.currentLineIndex < this.data.total_lines) {\n      const nextLine = this.data.lines[this.state.currentLineIndex];\n      if (\n        nextLine &&\n        nextLine.typing_sequence &&\n        nextLine.typing_sequence.length > 0\n      ) {\n        break;\n      }\n      this.state.completedLines.add(this.state.currentLineIndex);\n      this.state.currentLineIndex++;\n    }\n\n    // Check if test is complete\n    if (this.state.currentLineIndex >= this.data.total_lines) {\n      this.callbacks.onTestComplete();\n      return false;\n    }\n\n    return true;\n  }\n}","import { TestState, SnippetInfo } from \"./types/state\";\nimport { SnippetData } from \"./types/snippet\";\nimport { CodeRenderer } from \"./ui/renderer\";\nimport { KeyboardHandler } from \"./ui/keyboard\";\nimport {\n  PRESETS,\n  DEFAULT_CONFIG,\n  applyExclusionConfig,\n  loadConfig,\n  saveConfig,\n} from \"./core/config\";\nimport {\n  getElapsedTime,\n  calculateWPM,\n  calculateAccuracy,\n  formatTime,\n} from \"./core/timer\";\nimport { loadSnippetStats, saveSnippetStats } from \"./core/storage\";\n\n/**\n * Main application class for TreeType\n */\nexport class TreeTypeApp {\n  private state: TestState;\n  private data: SnippetData | null = null;\n  private rawData: SnippetData | null = null;\n  private snippetInfo: SnippetInfo;\n  private renderer: CodeRenderer;\n  private keyboardHandler: KeyboardHandler | null = null;\n\n  constructor() {\n    this.state = this.initializeState();\n    this.snippetInfo = { path: null, id: null, language: null };\n    this.renderer = new CodeRenderer(\"codeLines\");\n\n    this.setupEventListeners();\n    this.loadInitialSnippet();\n  }\n\n  /**\n   * Initialize test state\n   */\n  private initializeState(): TestState {\n    return {\n      active: false,\n      paused: false,\n      startTime: null,\n      endTime: null,\n      pauseStartTime: null,\n      totalPausedTime: 0,\n      currentLineIndex: 0,\n      currentCharIndex: 0,\n      totalCharsTyped: 0,\n      totalErrors: 0,\n      completedLines: new Set(),\n      errorOnCurrentChar: false,\n    };\n  }\n\n  /**\n   * Set up event listeners\n   */\n  private setupEventListeners(): void {\n    // Global keydown handler\n    document.addEventListener(\"keydown\", (e) => {\n      this.keyboardHandler?.handleKeyPress(e);\n    });\n\n    // Language selector\n    const languageSelect = document.getElementById(\n      \"languageSelect\"\n    ) as HTMLSelectElement;\n    languageSelect.addEventListener(\"change\", (e) => {\n      this.loadLanguage((e.target as HTMLSelectElement).value);\n      this.saveCurrentConfig();\n    });\n\n    // Typing mode radios\n    document.querySelectorAll('input[name=\"typingMode\"]').forEach((radio) => {\n      radio.addEventListener(\"change\", () => {\n        this.reapplyTypingMode();\n        this.saveCurrentConfig();\n      });\n    });\n\n    // Reset button\n    document.getElementById(\"resetBtn\")?.addEventListener(\"click\", () => {\n      this.resetTest();\n    });\n\n    // Pause button\n    document.getElementById(\"pauseBtn\")?.addEventListener(\"click\", () => {\n      this.togglePause();\n    });\n\n    // Code display focus\n    const codeDisplay = document.getElementById(\"codeDisplay\");\n    codeDisplay?.addEventListener(\"click\", () => {\n      codeDisplay.classList.add(\"focused\");\n    });\n    codeDisplay?.addEventListener(\"blur\", () => {\n      codeDisplay.classList.remove(\"focused\");\n    });\n  }\n\n  /**\n   * Load initial snippet based on saved config\n   */\n  private async loadInitialSnippet(): Promise<void> {\n    const config = loadConfig();\n\n    // Set UI to match config\n    const presetRadio = document.querySelector(\n      `input[name=\"typingMode\"][value=\"${config.preset}\"]`\n    ) as HTMLInputElement;\n    if (presetRadio) {\n      presetRadio.checked = true;\n    }\n\n    const languageSelect = document.getElementById(\n      \"languageSelect\"\n    ) as HTMLSelectElement;\n    languageSelect.value = config.language;\n\n    await this.loadLanguage(config.language);\n\n    setTimeout(() => {\n      document.getElementById(\"codeDisplay\")?.focus();\n    }, 100);\n  }\n\n  /**\n   * Load language snippet\n   */\n  async loadLanguage(language: string): Promise<void> {\n    const urlParams = new URLSearchParams(window.location.search);\n    const snippetPath = urlParams.get(\"snippet\");\n\n    let fetchPath: string;\n    if (snippetPath) {\n      fetchPath = snippetPath;\n    } else {\n      const defaultSnippets: Record<string, string> = {\n        python:\n          \"snippets/python/gm_01_001_02_03_core-python-patterns-quick-refresh.json\",\n        javascript: \"snippets/javascript/gm_01_001_01_array-methods.json\",\n        typescript: \"snippets/typescript/gm_01_026_01_apidata-patterns.json\",\n        tsx: \"snippets/tsx/gm_01_014_01_async-patterns.json\",\n      };\n      fetchPath = defaultSnippets[language];\n    }\n\n    try {\n      const response = await fetch(fetchPath);\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      this.rawData = await response.json();\n\n      this.snippetInfo.path = fetchPath;\n      this.snippetInfo.language = this.rawData!.language;\n\n      const pathParts = fetchPath.split(\"/\");\n      const filename = pathParts[pathParts.length - 1].replace(\".json\", \"\");\n      const lang = pathParts[pathParts.length - 2];\n      this.snippetInfo.id = `${lang}-${filename}`;\n\n      console.log(\"Loaded snippet:\", this.snippetInfo);\n\n      this.reapplyTypingMode();\n      this.resetTest();\n    } catch (error) {\n      console.error(\"Error loading file:\", error);\n      const codelinesEl = document.getElementById(\"codeLines\");\n      if (codelinesEl) {\n        codelinesEl.innerHTML = `\n          <div class=\"text-red-400\">\n            Error loading snippet<br>\n            Make sure you're running this from the project root directory.<br>\n            Error: ${\n              error instanceof Error ? error.message : String(error)\n            }<br><br>\n            <a href=\"library.html\" class=\"text-blue-400 underline\">Go to Library to select a snippet</a>\n          </div>\n        `;\n      }\n    }\n  }\n\n  /**\n   * Reapply typing mode to current data\n   */\n  private reapplyTypingMode(): void {\n    if (!this.rawData) return;\n\n    const preset = (\n      document.querySelector(\n        'input[name=\"typingMode\"]:checked'\n      ) as HTMLInputElement\n    )?.value as \"minimal\" | \"standard\" | \"full\";\n\n    this.data = {\n      ...this.rawData,\n      lines: this.rawData.lines.map((line) =>\n        applyExclusionConfig(line, preset)\n      ),\n    };\n\n    // Update keyboard handler with new data\n    if (this.keyboardHandler && this.data) {\n      this.keyboardHandler.updateReferences(this.state, this.data);\n    }\n  }\n\n  /**\n   * Save current configuration\n   */\n\n  private saveCurrentConfig(): void {\n    const preset = (\n      document.querySelector(\n        'input[name=\"typingMode\"]:checked'\n      ) as HTMLInputElement\n    )?.value as \"minimal\" | \"standard\" | \"full\";\n    const language = (\n      document.getElementById(\"languageSelect\") as HTMLSelectElement\n    )?.value as \"python\" | \"javascript\" | \"typescript\" | \"tsx\";\n\n    saveConfig({ preset, language });\n  }\n\n  /**\n   * Reset test to initial state\n   */\n  resetTest(): void {\n    this.state = this.initializeState();\n\n    if (this.data) {\n      // Skip to first typeable line\n      while (\n        this.state.currentLineIndex < this.data.total_lines &&\n        (!this.data.lines[this.state.currentLineIndex] ||\n          this.data.lines[this.state.currentLineIndex].typing_sequence\n            .length === 0)\n      ) {\n        this.state.currentLineIndex++;\n      }\n    }\n\n    document.body.classList.remove(\"test-active\");\n    this.hidePauseOverlay();\n\n    if (this.data) {\n      this.renderer.renderCode(this.data, this.state);\n\n      // Create keyboard handler with callbacks\n      this.keyboardHandler = new KeyboardHandler(\n        this.state,\n        this.data,\n        this.snippetInfo,\n        {\n          onTestStart: () => this.startTest(),\n          onCharacterTyped: () => this.updateDisplay(),\n          onLineComplete: () => this.moveToNextLine(),\n          onTestComplete: () => this.completeTest(),\n          onPauseToggle: () => this.togglePause(),\n          onReset: () => {\n            this.closeModal();\n            this.resetTest();\n          },\n        }\n      );\n    }\n\n    this.updateStats();\n    this.updatePauseButton();\n    this.updateStatus(\"Press any key to start...\");\n\n    // Scroll to first line\n    requestAnimationFrame(() => {\n      const firstLine = document.getElementById(\n        `line-${this.state.currentLineIndex}`\n      );\n      if (firstLine) {\n        const targetY =\n          firstLine.offsetTop -\n          window.innerHeight / 4 +\n          firstLine.offsetHeight / 4;\n        window.scrollTo({\n          top: targetY,\n          behavior: \"auto\",\n        });\n      }\n    });\n  }\n\n  /**\n   * Start the typing test\n   */\n  private startTest(): void {\n    this.state.active = true;\n    this.state.startTime = Date.now();\n    this.updateStatus(\"Typing...\", \"success\");\n    document.body.classList.add(\"test-active\");\n    this.updatePauseButton();\n  }\n\n  /**\n   * Toggle pause state\n   */\n  private togglePause(): void {\n    if (!this.state.active) {\n      console.log(\"Cannot pause: test not active\");\n      return;\n    }\n\n    if (this.state.paused) {\n      // Resume\n      console.log(\"Resuming test\");\n\n      const pauseDuration = Date.now() - (this.state.pauseStartTime || 0);\n      this.state.totalPausedTime += pauseDuration;\n\n      this.state.paused = false;\n      this.state.pauseStartTime = null;\n\n      this.hidePauseOverlay();\n      this.updatePauseButton();\n      this.updateStatus(\"Typing...\", \"success\");\n\n      document.getElementById(\"codeDisplay\")?.focus();\n    } else {\n      // Pause\n      console.log(\"Pausing test\");\n\n      this.state.paused = true;\n      this.state.pauseStartTime = Date.now();\n\n      this.showPauseOverlay();\n      this.updatePauseButton();\n      this.updateStatus(\"Paused (Tab to resume)\", \"warning\");\n    }\n\n    this.updateStats();\n  }\n\n  /**\n   * Show pause overlay\n   */\n  private showPauseOverlay(): void {\n    this.hidePauseOverlay();\n\n    const overlay = document.createElement(\"div\");\n    overlay.id = \"pauseOverlay\";\n    overlay.className = \"pause-overlay\";\n    overlay.innerHTML = `\n      <div class=\"pause-content\">\n        <div class=\"pause-icon\">‚∏∏</div>\n        <h2 class=\"text-3xl font-bold mb-4\">Paused</h2>\n        <p class=\"text-lg mb-2\">Press <kbd class=\"pause-kbd\">Tab</kbd> to resume</p>\n        <p class=\"text-sm text-gray-400 mt-4\">or <kbd class=\"pause-kbd\">Esc</kbd> to reset test</p>\n      </div>\n    `;\n    document.body.appendChild(overlay);\n\n    overlay.addEventListener(\"click\", () => this.togglePause());\n  }\n\n  /**\n   * Hide pause overlay\n   */\n  private hidePauseOverlay(): void {\n    const overlay = document.getElementById(\"pauseOverlay\");\n    if (overlay) {\n      overlay.remove();\n    }\n  }\n\n  /**\n   * Update pause button state\n   */\n  private updatePauseButton(): void {\n    const btn = document.getElementById(\"pauseBtn\");\n    if (!btn) return;\n\n    if (this.state.paused) {\n      btn.textContent = \"‚ñ∂Ô∏è Resume\";\n      btn.classList.add(\"paused-state\");\n    } else {\n      btn.textContent = \"‚∏∏ Pause\";\n      btn.classList.remove(\"paused-state\");\n    }\n\n    if (!this.state.active) {\n      btn.setAttribute(\"disabled\", \"true\");\n      btn.classList.add(\"opacity-50\", \"cursor-not-allowed\");\n    } else {\n      btn.removeAttribute(\"disabled\");\n      btn.classList.remove(\"opacity-50\", \"cursor-not-allowed\");\n    }\n  }\n\n  /**\n   * Update display after character typed\n   */\n  private updateDisplay(): void {\n    if (!this.data) return;\n\n    const currentLine = this.data.lines[this.state.currentLineIndex];\n    this.renderer.updateCurrentLine(\n      currentLine,\n      this.state.currentLineIndex,\n      this.state\n    );\n    this.updateStats();\n  }\n\n  /**\n   * Move to next line\n   */\n  private moveToNextLine(): void {\n    if (!this.keyboardHandler) return;\n\n    const moved = this.keyboardHandler.moveToNextLine();\n\n    if (moved && this.data) {\n      this.renderer.renderCode(this.data, this.state);\n      this.updateStats();\n      setTimeout(() => this.smartScroll(), 0);\n    }\n  }\n\n  /**\n   * Smart scroll to keep current line visible\n   */\n  private smartScroll(): void {\n    const nextLineEl = document.getElementById(\n      `line-${this.state.currentLineIndex}`\n    );\n    if (!nextLineEl) return;\n\n    const currentScrollY = window.scrollY;\n    const viewportHeight = window.innerHeight;\n\n    const targetY =\n      nextLineEl.offsetTop - viewportHeight / 4 + nextLineEl.offsetHeight / 4;\n\n    if (targetY > currentScrollY) {\n      window.scrollTo({\n        top: targetY,\n      });\n    }\n  }\n\n  /**\n   * Complete the test\n   */\n  private completeTest(): void {\n    this.state.active = false;\n    this.state.endTime = Date.now();\n    document.body.classList.remove(\"test-active\");\n\n    const elapsed = getElapsedTime(this.state);\n    const timeStr = formatTime(elapsed);\n    const wpm = calculateWPM(this.state.totalCharsTyped, elapsed);\n    const accuracy = calculateAccuracy(\n      this.state.totalCharsTyped,\n      this.state.totalErrors\n    );\n\n    // Save stats\n    if (this.snippetInfo.id) {\n      saveSnippetStats(this.snippetInfo.id, wpm, accuracy);\n    }\n\n    this.updatePauseButton();\n    this.showCompletionModal(wpm, accuracy, timeStr);\n    this.updateStats();\n  }\n\n  /**\n   * Show completion modal\n   */\n  private showCompletionModal(\n    wpm: number,\n    accuracy: number,\n    timeStr: string\n  ): void {\n    const overlay = document.createElement(\"div\");\n    overlay.className = \"modal-overlay\";\n    overlay.id = \"completionModal\";\n    overlay.innerHTML = `\n      <div class=\"modal-content p-8 gap-5\" style=\"max-width: 525px\">\n        <!-- Header -->\n        <div>\n          <h2 class=\"text-4xl font-bold\">üéâ Test Complete!</h2>\n          <p class=\"text-lg text-gray-400 mt-2\">Great job on completing the test</p>\n        </div>\n\n        <!-- Stats (Integrated Grid) -->\n        <div class=\"grid grid-cols-3 gap-4 py-3 text-center\">\n          <div>\n            <p class=\"text-base text-gray-400 uppercase tracking-wider\">WPM</p>\n            <p class=\"text-5xl font-bold text-green-400\">${wpm}</p>\n          </div>\n          <div>\n            <p class=\"text-base text-gray-400 uppercase tracking-wider\">Accuracy</p>\n            <p class=\"text-5xl font-bold text-green-400\">${accuracy}%</p>\n          </div>\n          <div>\n            <p class=\"text-base text-gray-400 uppercase tracking-wider\">Time</p>\n            <p class=\"text-5xl font-bold text-green-400\">${timeStr}</p>\n          </div>\n        </div>\n\n        <!-- Divider -->\n        <hr class=\"border-gray-600\" />\n\n        <!-- Buttons (2x2 Grid for equal sizing) -->\n        <div class=\"grid grid-cols-2 gap-4\">\n          <button id=\"retryBtn\" class=\"modal-button modal-button-primary text-lg py-4 px-5\">\n            <span>üîÑ</span> Retry\n          </button>\n          <button id=\"randomBtn\" class=\"modal-button modal-button-primary text-lg py-4 px-5\">\n            <span>üé≤</span> Random\n          </button>\n          <button id=\"libraryBtn\" class=\"modal-button modal-button-secondary text-lg py-4 px-5\">\n            <span>üìö</span> Library\n          </button>\n          <button id=\"settingsBtn\" class=\"modal-button modal-button-secondary text-lg py-4 px-5\">\n            <span>‚öôÔ∏è</span> Settings\n          </button>\n        </div>\n      </div>\n    `;\n    document.body.appendChild(overlay);\n\n    // Add event listeners to modal buttons\n    document.getElementById(\"retryBtn\")?.addEventListener(\"click\", () => {\n      this.closeModal();\n      this.resetTest();\n    });\n\n    document.getElementById(\"randomBtn\")?.addEventListener(\"click\", () => {\n      this.loadRandomSnippet();\n    });\n\n    document.getElementById(\"libraryBtn\")?.addEventListener(\"click\", () => {\n      window.location.href = \"library.html\";\n    });\n\n    document.getElementById(\"settingsBtn\")?.addEventListener(\"click\", () => {\n      this.closeModal();\n    });\n\n    overlay.addEventListener(\"click\", (e) => {\n      if (e.target === overlay) this.closeModal();\n    });\n  }\n\n  /**\n   * Close modal\n   */\n  private closeModal(): void {\n    const modal = document.getElementById(\"completionModal\");\n    if (modal) modal.remove();\n  }\n\n  /**\n   * Load random snippet\n   */\n  private async loadRandomSnippet(): Promise<void> {\n    try {\n      const response = await fetch(\"snippets/metadata.json\");\n      if (!response.ok) throw new Error(\"Cannot fetch metadata\");\n\n      const metadata = await response.json();\n      const snippets = metadata.snippets;\n\n      const randomSnippet =\n        snippets[Math.floor(Math.random() * snippets.length)];\n\n      window.location.href = `index.html?snippet=${encodeURIComponent(\n        randomSnippet.path\n      )}`;\n    } catch (error) {\n      console.error(\"Error loading random snippet:\", error);\n      alert(\"Could not load random snippet. Please try again.\");\n    }\n  }\n\n  /**\n   * Update stats display\n   */\n  private updateStats(): void {\n    if (!this.data) return;\n\n    const currentLine = this.data.lines[this.state.currentLineIndex];\n    const progress = currentLine\n      ? `${this.state.currentCharIndex}/${currentLine.typing_sequence.length}`\n      : \"0/0\";\n\n    let wpm = 0;\n    let accuracy = 100;\n\n    if (this.state.active && this.state.startTime && !this.state.paused) {\n      const elapsedSeconds = getElapsedTime(this.state);\n      wpm = calculateWPM(this.state.totalCharsTyped, elapsedSeconds);\n    }\n\n    if (this.state.totalCharsTyped > 0) {\n      accuracy = calculateAccuracy(\n        this.state.totalCharsTyped,\n        this.state.totalErrors\n      );\n    }\n\n    const preset = (\n      document.querySelector(\n        'input[name=\"typingMode\"]:checked'\n      ) as HTMLInputElement\n    )?.value;\n    const presetName = PRESETS[preset as keyof typeof PRESETS]?.name || preset;\n\n    const statsEl = document.getElementById(\"stats\");\n    if (statsEl) {\n      statsEl.innerHTML = `\n        <div class=\"grid grid-cols-6 gap-4 text-sm\">\n          <div><div class=\"text-gray-400\">Language</div><div class=\"font-bold\">${\n            this.data.language\n          }</div></div>\n          <div><div class=\"text-gray-400\">Mode</div><div class=\"font-bold\">${presetName}</div></div>\n          <div><div class=\"text-gray-400\">Line Progress</div><div class=\"font-bold\">${\n            this.state.currentLineIndex + 1\n          }/${this.data.total_lines}</div></div>\n          <div><div class=\"text-gray-400\">Char Progress</div><div class=\"font-bold\">${progress}</div></div>\n          <div><div class=\"text-gray-400\">WPM</div><div class=\"font-bold\">${wpm}</div></div>\n          <div><div class=\"text-gray-400\">Accuracy</div><div class=\"font-bold ${\n            accuracy < 95 ? \"text-yellow-400\" : \"text-green-400\"\n          }\">${accuracy}%</div></div>\n        </div>\n      `;\n    }\n  }\n\n  /**\n   * Update status message\n   */\n  private updateStatus(message: string, type: string = \"info\"): void {\n    const statusEl = document.getElementById(\"testStatus\");\n    const colors: Record<string, string> = {\n      info: \"text-gray-400\",\n      success: \"text-green-400\",\n      error: \"text-red-400\",\n      warning: \"text-yellow-400\",\n    };\n    if (statusEl) {\n      statusEl.innerHTML = `<span class=\"${colors[type]}\">${message}</span>`;\n    }\n  }\n}","\n      import { TreeTypeApp } from \"./src/app.js\";\n\n      // Initialize app when DOM is ready\n      document.addEventListener(\"DOMContentLoaded\", () => {\n        new TreeTypeApp();\n      });\n    "],"names":["CodeRenderer","constructor","containerId","element","document","getElementById","Error","this","container","renderCode","data","state","innerHTML","lines","forEach","lineData","lineIndex","lineDiv","createLineElement","appendChild","updateCurrentLine","contentDiv","renderLineTokens","querySelectorAll","line","idx","classList","add","remove","createElement","className","id","currentLineIndex","lineNum","textContent","String","line_number","style","paddingLeft","indent_level","currentCol","typedCharCount","isCurrentLine","isCompletedLine","completedLines","has","isFutureLine","display_tokens","token","start_col","spaces","repeat","createTextNode","baseCssClass","getCssClass","type","text","typeable","i","length","charSpan","currentCharIndex","errorOnCurrentChar","tokenSpan","currentCharInfo","char_map","currentDisplayCol","display_col","end_col","includes","replace","KeyboardHandler","snippetInfo","callbacks","updateReferences","handleKeyPress","event","key","active","preventDefault","onPauseToggle","paused","onReset","ctrlKey","metaKey","altKey","onTestStart","currentLine","expectedChar","typing_sequence","totalCharsTyped","onCharacterTyped","setTimeout","onLineComplete","totalErrors","moveToNextLine","total_lines","nextLine","onTestComplete","TreeTypeApp","rawData","keyboardHandler","initializeState","path","language","renderer","setupEventListeners","loadInitialSnippet","startTime","endTime","pauseStartTime","totalPausedTime","Set","addEventListener","e","loadLanguage","target","value","saveCurrentConfig","radio","reapplyTypingMode","resetTest","togglePause","codeDisplay","config","loadConfig","presetRadio","querySelector","preset","checked","focus","snippetPath","URLSearchParams","window","location","search","get","fetchPath","python","javascript","typescript","tsx","response","fetch","ok","status","json","pathParts","split","filename","lang","console","log","error","codelinesEl","message","map","applyExclusionConfig","saveConfig","body","hidePauseOverlay","startTest","updateDisplay","completeTest","closeModal","updateStats","updatePauseButton","updateStatus","requestAnimationFrame","firstLine","targetY","offsetTop","innerHeight","offsetHeight","scrollTo","top","behavior","Date","now","pauseDuration","showPauseOverlay","overlay","btn","removeAttribute","setAttribute","smartScroll","nextLineEl","currentScrollY","scrollY","viewportHeight","elapsed","getElapsedTime","timeStr","formatTime","wpm","calculateWPM","accuracy","calculateAccuracy","saveSnippetStats","showCompletionModal","loadRandomSnippet","href","modal","snippets","randomSnippet","Math","floor","random","encodeURIComponent","alert","progress","elapsedSeconds","presetName","PRESETS","name","statsEl","statusEl","colors","info","success","warning"],"mappings":"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"}