{"version":3,"file":"config-wtE3mAnz.js","sources":["../../src/core/config.ts"],"sourcesContent":["import { PresetsConfig, UserConfig, TypingMode } from \"../types/config\";\nimport { Line, Token } from \"../types/snippet\";\n\n/**\n * Preset configurations for typing modes\n */\nexport const PRESETS: PresetsConfig = {\n  minimal: {\n    name: \"Minimal\",\n    description: \"Type only keywords and identifiers\",\n    exclude: [\n      \"parenthesis\",\n      \"curly_brace\",\n      \"square_bracket\",\n      \"angle_bracket\",\n      \"operator\",\n      \"punctuation\",\n      \"string_content\",\n      \"string_delimiter\",\n      \"comment\",\n    ],\n  },\n  standard: {\n    name: \"Standard\",\n    description: \"Balanced practice without pinky strain (recommended)\",\n    exclude: [\n      \"curly_brace\",\n      \"square_bracket\",\n      \"angle_bracket\",\n      \"string_content\",\n      \"punctuation\",\n      \"string_delimiter\",\n      \"comment\",\n    ],\n    includeSpecific: [\":\", \".\", \",\", \"(\", \")\"],\n  },\n  full: {\n    name: \"Full\",\n    description: \"Type everything except whitespace and comments\",\n    exclude: [\"comment\", \"string_content\"],\n  },\n};\n\n/**\n * Default user configuration\n */\nexport const DEFAULT_CONFIG: UserConfig = {\n  preset: \"standard\",\n  language: \"python\",\n};\n\n/**\n * Helper function to detect if a token is a JSX tag name\n * Handles both simple tags (<div>) and tags with attributes (<button onClick={...}>)\n */\nfunction isJSXTagName(\n  token: Token,\n  idx: number,\n  tokens: Token[]\n): boolean {\n  // Must be an identifier-like token\n  if (token.type !== \"identifier\" && token.type !== \"type_identifier\") {\n    return false;\n  }\n\n  const prevToken = idx > 0 ? tokens[idx - 1] : null;\n\n  // Must follow < or </\n  if (!prevToken || (prevToken.text !== \"<\" && prevToken.text !== \"</\")) {\n    return false;\n  }\n\n  // Look ahead to find the closing > or />\n  // Skip over attributes, whitespace, etc.\n  for (let i = idx + 1; i < tokens.length; i++) {\n    const nextToken = tokens[i];\n    \n    // Found the closing bracket - this is a JSX tag name\n    if (nextToken.text === \">\" || nextToken.text === \"/>\") {\n      return true;\n    }\n\n    // If we hit another opening bracket, this is probably not a JSX tag\n    // THIS WAS THE BUG: We no longer check for \"{\" here.\n    if (nextToken.text === \"<\") {\n      return false;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Apply exclusion config to line data\n *\n * CRITICAL FIXES INCLUDED:\n * 1. Whitespace is NEVER typeable\n * 2. JSX tag names follow angle_bracket exclusion rules (handles attributes)\n * 3. includeSpecific has highest priority\n */\nexport function applyExclusionConfig(lineData: Line, preset: TypingMode): Line {\n  const config = PRESETS[preset];\n\n  const filteredTokens: Token[] = lineData.display_tokens.map((token, idx) => {\n    let typeable = token.base_typeable;\n\n    // CRITICAL FIX #1: Whitespace is NEVER typeable\n    if (token.text.trim() === \"\") {\n      return { ...token, typeable: false };\n    }\n\n    // If token is not base_typeable, keep it that way\n    if (!typeable) {\n      return { ...token, typeable };\n    }\n\n    // CRITICAL FIX #2: JSX tag names follow angle_bracket exclusion rules\n    if (isJSXTagName(token, idx, lineData.display_tokens)) {\n      // This is a JSX tag name - apply angle_bracket exclusion rules\n      if (config.exclude.includes(\"angle_bracket\")) {\n        return { ...token, typeable: false };\n      }\n    }\n\n    // CRITICAL FIX #3: Check includeSpecific FIRST (highest priority)\n    if (config.includeSpecific?.includes(token.text)) {\n      return { ...token, typeable: true };\n    }\n\n    // If no categories, default to typeable (keywords, identifiers)\n    if (!token.categories || token.categories.length === 0) {\n      return { ...token, typeable: true };\n    }\n\n    // Check if any category is excluded\n    for (const category of token.categories) {\n      if (config.exclude.includes(category)) {\n        typeable = false;\n        break;\n      }\n    }\n\n    return { ...token, typeable };\n  });\n\n  // Regenerate typing sequence from typeable tokens only\n  const typingSequence = filteredTokens\n    .filter((t) => t.typeable)\n    .map((t) => t.text)\n    .join(\"\");\n\n  // Regenerate char_map\n  const charMap: Line[\"char_map\"] = {};\n  let charIdx = 0;\n\n  filteredTokens.forEach((token, tokenIdx) => {\n    if (token.typeable) {\n      for (let i = 0; i < token.text.length; i++) {\n        charMap[String(charIdx)] = {\n          token_idx: tokenIdx,\n          display_col: token.start_col,\n        };\n        charIdx++;\n      }\n    }\n  });\n\n  return {\n    ...lineData,\n    display_tokens: filteredTokens,\n    typing_sequence: typingSequence,\n    char_map: charMap,\n  };\n}\n\n/**\n * Save user configuration to localStorage\n */\nexport function saveConfig(config: UserConfig): void {\n  localStorage.setItem(\"treetype_config\", JSON.stringify(config));\n}\n\n/**\n * Load user configuration from localStorage\n */\nexport function loadConfig(): UserConfig {\n  const saved = localStorage.getItem(\"treetype_config\");\n  return saved ? JSON.parse(saved) : DEFAULT_CONFIG;\n}"],"names":["PRESETS","minimal","name","description","exclude","standard","includeSpecific","full","DEFAULT_CONFIG","preset","language","applyExclusionConfig","lineData","config","filteredTokens","display_tokens","map","token","idx","typeable","base_typeable","text","trim","tokens","type","prevToken","i","length","nextToken","isJSXTagName","includes","categories","category","typingSequence","filter","t","join","charMap","charIdx","forEach","tokenIdx","String","token_idx","display_col","start_col","typing_sequence","char_map","saveConfig","localStorage","setItem","JSON","stringify","loadConfig","saved","getItem","parse"],"mappings":"AAMO,MAAMA,EAAyB,CACpCC,QAAS,CACPC,KAAM,UACNC,YAAa,qCACbC,QAAS,CACP,cACA,cACA,iBACA,gBACA,WACA,cACA,iBACA,mBACA,YAGJC,SAAU,CACRH,KAAM,WACNC,YAAa,uDACbC,QAAS,CACP,cACA,iBACA,gBACA,iBACA,cACA,mBACA,WAEFE,gBAAiB,CAAC,IAAK,IAAK,IAAK,IAAK,MAExCC,KAAM,CACJL,KAAM,OACNC,YAAa,iDACbC,QAAS,CAAC,UAAW,oBAOZI,EAA6B,CACxCC,OAAQ,WACRC,SAAU,UAoDL,SAASC,EAAqBC,EAAgBH,GACnD,MAAMI,EAASb,EAAQS,GAEjBK,EAA0BF,EAASG,eAAeC,IAAI,CAACC,EAAOC,KAClE,IAAIC,EAAWF,EAAMG,cAGrB,GAA0B,KAAtBH,EAAMI,KAAKC,OACb,MAAO,IAAKL,EAAOE,UAAU,GAI/B,IAAKA,EACH,MAAO,IAAKF,EAAOE,YAIrB,GA9DJ,SACEF,EACAC,EACAK,GAGA,GAAmB,eAAfN,EAAMO,MAAwC,oBAAfP,EAAMO,KACvC,OAAO,EAGT,MAAMC,EAAYP,EAAM,EAAIK,EAAOL,EAAM,GAAK,KAG9C,IAAKO,GAAiC,MAAnBA,EAAUJ,MAAmC,OAAnBI,EAAUJ,KACrD,OAAO,EAKT,IAAA,IAASK,EAAIR,EAAM,EAAGQ,EAAIH,EAAOI,OAAQD,IAAK,CAC5C,MAAME,EAAYL,EAAOG,GAGzB,GAAuB,MAAnBE,EAAUP,MAAmC,OAAnBO,EAAUP,KACtC,OAAO,EAKT,GAAuB,MAAnBO,EAAUP,KACZ,OAAO,CAEX,CAEA,OAAO,CACT,CA2BQQ,CAAaZ,EAAOC,EAAKN,EAASG,iBAEhCF,EAAOT,QAAQ0B,SAAS,iBAC1B,MAAO,IAAKb,EAAOE,UAAU,GAKjC,GAAIN,EAAOP,iBAAiBwB,SAASb,EAAMI,MACzC,MAAO,IAAKJ,EAAOE,UAAU,GAI/B,IAAKF,EAAMc,YAA0C,IAA5Bd,EAAMc,WAAWJ,OACxC,MAAO,IAAKV,EAAOE,UAAU,GAI/B,IAAA,MAAWa,KAAYf,EAAMc,WAC3B,GAAIlB,EAAOT,QAAQ0B,SAASE,GAAW,CACrCb,GAAW,EACX,KACF,CAGF,MAAO,IAAKF,EAAOE,cAIfc,EAAiBnB,EACpBoB,OAAQC,GAAMA,EAAEhB,UAChBH,IAAKmB,GAAMA,EAAEd,MACbe,KAAK,IAGFC,EAA4B,CAAA,EAClC,IAAIC,EAAU,EAcd,OAZAxB,EAAeyB,QAAQ,CAACtB,EAAOuB,KAC7B,GAAIvB,EAAME,SACR,IAAA,IAASO,EAAI,EAAGA,EAAIT,EAAMI,KAAKM,OAAQD,IACrCW,EAAQI,OAAOH,IAAY,CACzBI,UAAWF,EACXG,YAAa1B,EAAM2B,WAErBN,MAKC,IACF1B,EACHG,eAAgBD,EAChB+B,gBAAiBZ,EACjBa,SAAUT,EAEd,CAKO,SAASU,EAAWlC,GACzBmC,aAAaC,QAAQ,kBAAmBC,KAAKC,UAAUtC,GACzD,CAKO,SAASuC,IACd,MAAMC,EAAQL,aAAaM,QAAQ,mBACnC,OAAOD,EAAQH,KAAKK,MAAMF,GAAS7C,CACrC"}